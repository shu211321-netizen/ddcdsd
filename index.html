<!doctype html><html lang="ko"><meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ë¬¸ì œí’€ì´ íƒ€ì´ë¨¸</title>

<style>
body{margin:0;font-family:system-ui;background:#fff}
#app{min-height:100vh;display:flex;flex-direction:column;justify-content:flex-end;padding:14px;box-sizing:border-box}
.card{border:1px solid #e6e6e6;border-radius:18px;padding:14px;margin-top:12px}
.time{font-size:18vw;font-weight:900;text-align:center;letter-spacing:-.04em;line-height:1}
.sub{text-align:center;color:#666;margin-top:6px}
.ui{display:block}
.focus .ui{display:none}
.focus.showui .ui{display:block}
.row{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
input,button{flex:1;font-size:18px;padding:14px;border-radius:14px;border:1px solid #ccc;box-sizing:border-box}
button{border:none;background:#111;color:#fff;font-weight:800}
.sec{background:#eee;color:#111}
#toggle{position:fixed;right:14px;bottom:14px;border-radius:999px;padding:12px 16px;display:none;box-shadow:0 6px 18px rgba(0,0,0,.12)}
.focus #toggle{display:block}

.kpi{display:flex;gap:10px;margin-top:10px}
.kpi .box{flex:1;border:1px solid #eee;border-radius:14px;padding:12px;text-align:center}
.kpi .lab{color:#666;font-size:13px}
.kpi .val{font-size:26px;font-weight:900;margin-top:2px}

.panel{margin-top:10px;border:1px solid #eee;border-radius:14px;overflow:hidden}
.panel-h{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:#fafafa}
.panel-h b{font-size:14px}
.panel-h button{flex:0;padding:8px 10px;border-radius:12px;font-size:14px}
.panel-b{padding:10px 12px;display:none}
.showrec .panel-b{display:block}

.muted{color:#666;font-size:13px}
dialog{border:none;border-radius:18px;padding:16px;width:90vw;max-width:420px}
dialog::backdrop{background:rgba(0,0,0,.4)}
.err{color:#b00020;font-size:13px;margin-top:8px;display:none}

.pills{display:flex;gap:10px;margin-top:10px}
.pill{flex:1;padding:12px;border-radius:14px;border:1px solid #ccc;background:#fff;color:#111;font-weight:900}
.pill.on{background:#111;color:#fff;border-color:#111}

/* ë­í‚¹ UI */
.rankTabs{display:flex;gap:8px;margin:10px 0}
.tab{flex:1;padding:10px;border-radius:12px;border:1px solid #ddd;background:#fff;color:#111;font-weight:900;font-size:14px}
.tab.on{background:#111;color:#fff;border-color:#111}
.leader{display:flex;flex-direction:column;gap:8px;max-height:28vh;overflow:auto}
.rowRank{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border:1px solid #eee;border-radius:14px}
.rleft{display:flex;align-items:center;gap:10px;min-width:0}
.badge{font-weight:900;min-width:44px;text-align:center}
.tag{font-size:12px;border:1px solid #eee;border-radius:999px;padding:4px 8px;white-space:nowrap}
.mainTxt{font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:46vw}
.rsub{font-size:12px;color:#666;margin-top:2px}
.rright{text-align:right;font-weight:900}
.rright .subp{font-size:12px;color:#666;font-weight:700;margin-top:2px}
</style>

<div id="app">
  <!-- íƒ€ì´ë¨¸ -->
  <div class="card">
    <div class="time" id="t">25:00</div>
    <div class="sub" id="state">ì¤€ë¹„ë¨</div>
  </div>

  <!-- UI -->
  <div class="card ui" id="ui">
    <div class="row">
      <input id="m" type="number" value="25" min="0" placeholder="ë¶„">
      <input id="s" type="number" value="0" min="0" max="59" placeholder="ì´ˆ">
    </div>
    <div class="row">
      <button id="start">ì‹œì‘</button>
      <button id="pause" class="sec" disabled>ì¼ì‹œì •ì§€</button>
      <button id="reset" class="sec">ë¦¬ì…‹</button>
    </div>

    <div class="kpi">
      <div class="box"><div class="lab">ì˜¤ëŠ˜ í‘¼ ê°œìˆ˜</div><div class="val" id="todaySolved">0</div></div>
      <div class="box"><div class="lab">ì „ì²´ í‘¼ ê°œìˆ˜</div><div class="val" id="allSolved">0</div></div>
    </div>

    <!-- ë­í‚¹ íŒ¨ë„ -->
    <div class="panel" id="rankPanel">
      <div class="panel-h">
        <b>ğŸ† ë­í‚¹(ì •ë‹µë¥  ê¸°ì¤€)</b>
        <div style="display:flex;gap:8px">
          <button id="rankToggle" class="sec">í¼ì¹˜ê¸°</button>
          <button id="clear" class="sec">ì‚­ì œ</button>
        </div>
      </div>

      <div class="panel-b" id="rankBody">
        <div class="rankTabs">
          <button class="tab on" id="tabAll" type="button">ì „ì²´</button>
          <button class="tab" id="tabMath" type="button">ìˆ˜í•™</button>
          <button class="tab" id="tabSci" type="button">ê³¼í•™</button>
        </div>
        <div class="leader" id="leader"></div>
        <div class="muted" style="margin-top:8px">ì •ë ¬: ì •ë‹µë¥ â†“ â†’ í‘¼ ê°œìˆ˜â†“ â†’ ìµœì‹ </div>
      </div>
    </div>
  </div>

  <button id="toggle">UI ë³´ê¸°</button>
</div>

<!-- ì¢…ë£Œ ì…ë ¥ -->
<dialog id="dlg">
  <b>ë! ê³¼ëª© + ì •ë‹µ/í’€ì´ ì…ë ¥</b>

  <div class="muted" style="margin-top:6px">ê³¼ëª©(2ê°œ)</div>
  <div class="pills">
    <button id="subMath" class="pill on" type="button">ìˆ˜í•™</button>
    <button id="subSci" class="pill" type="button">ê³¼í•™</button>
  </div>

  <div class="muted" style="margin-top:10px">í˜•ì‹: (ë§ì€ê°œìˆ˜)/(í‘¼ê°œìˆ˜) ì˜ˆ) 18/25</div>
  <input id="score" type="text" placeholder="ì˜ˆ: 18/25" style="width:100%;margin-top:8px">
  <div class="err" id="err">ì…ë ¥ì„ í™•ì¸í•´ì¤˜.</div>

  <div class="row" style="margin-top:10px">
    <button id="skip" class="sec" type="button">ê±´ë„ˆë›°ê¸°</button>
    <button id="save" type="button">ì €ì¥</button>
  </div>
</dialog>

<script>
(()=>{const KEY="solve_timer_entries_rank_v1",A=id=>document.getElementById(id);
const app=A("app"),t=A("t"),state=A("state"),m=A("m"),s=A("s"),
start=A("start"),pause=A("pause"),reset=A("reset"),toggle=A("toggle"),
dlg=A("dlg"),score=A("score"),err=A("err"),save=A("save"),skip=A("skip"),
todaySolved=A("todaySolved"),allSolved=A("allSolved"),
clear=A("clear"),
rankPanel=A("rankPanel"),rankToggle=A("rankToggle"),
leader=A("leader"),
tabAll=A("tabAll"),tabMath=A("tabMath"),tabSci=A("tabSci"),
subMath=A("subMath"),subSci=A("subSci");

let data=JSON.parse(localStorage.getItem(KEY)||"[]");
let dur=1500,rem=dur,timer=null,uiOpen=false,lastDur=dur,subject="ìˆ˜í•™";
let rankFilter="ì „ì²´";

const pad=n=>String(n).padStart(2,"0");
const fmt=x=>`${pad(x/60|0)}:${pad(x%60)}`;
const dayKey=ts=>{const d=new Date(ts);return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;}
const stamp=ts=>{const d=new Date(ts);return `${pad(d.getMonth()+1)}/${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;}

const sync=()=>{const mm=Math.max(0,Math.min(300,parseInt(m.value||25,10)||0));
const ss=Math.max(0,Math.min(59,parseInt(s.value||0,10)||0));m.value=mm;s.value=ss;
dur=Math.max(1,mm*60+ss); if(!timer) rem=dur;
t.textContent=fmt(rem); t.style.color=rem<=60?"#b00020":"#111";}

const setFocus=on=>{app.classList.toggle("focus",on);app.classList.remove("showui");
toggle.textContent="UI ë³´ê¸°";uiOpen=false;
if(on){rankPanel.classList.remove("showrec");rankToggle.textContent="í¼ì¹˜ê¸°";}
}
toggle.onclick=()=>{uiOpen=!uiOpen;app.classList.toggle("showui",uiOpen);
toggle.textContent=uiOpen?"UI ìˆ¨ê¹€":"UI ë³´ê¸°";}

rankToggle.onclick=()=>{const on=!rankPanel.classList.contains("showrec");
rankPanel.classList.toggle("showrec",on);rankToggle.textContent=on?"ì ‘ê¸°":"í¼ì¹˜ê¸°";}

const pickSub=(x)=>{subject=x;subMath.classList.toggle("on",x==="ìˆ˜í•™");subSci.classList.toggle("on",x==="ê³¼í•™");}
subMath.onclick=()=>pickSub("ìˆ˜í•™");
subSci.onclick=()=>pickSub("ê³¼í•™");

const setTab=(x)=>{
  rankFilter=x;
  tabAll.classList.toggle("on",x==="ì „ì²´");
  tabMath.classList.toggle("on",x==="ìˆ˜í•™");
  tabSci.classList.toggle("on",x==="ê³¼í•™");
  renderLeader();
};
tabAll.onclick=()=>setTab("ì „ì²´");
tabMath.onclick=()=>setTab("ìˆ˜í•™");
tabSci.onclick=()=>setTab("ê³¼í•™");

const renderKPI=()=>{
  const td=dayKey(Date.now()); let Tsol=0,Asol=0;
  for(const e of data){Asol+=e.solved||0;if(dayKey(e.ts)===td)Tsol+=e.solved||0}
  todaySolved.textContent=Tsol; allSolved.textContent=Asol;
};

const medal=(i)=> i===1?"ğŸ¥‡":i===2?"ğŸ¥ˆ":i===3?"ğŸ¥‰":`#${i}`;
const renderLeader=()=>{
  leader.innerHTML="";
  let arr = data.slice();
  if(rankFilter!=="ì „ì²´") arr = arr.filter(e=>e.subject===rankFilter);

  arr.sort((a,b)=>{
    if(b.acc!==a.acc) return b.acc-a.acc;
    if(b.solved!==a.solved) return b.solved-a.solved;
    return b.ts-a.ts;
  });

  const top = arr.slice(0, 30);
  if(!top.length){
    leader.innerHTML = `<div class="muted">ê¸°ë¡ ì—†ìŒ. íƒ€ì´ë¨¸ ëë‚´ê³  ì €ì¥í•´ë´!</div>`;
    return;
  }

  top.forEach((e,idx)=>{
    const r = idx+1;
    const div=document.createElement("div");
    div.className="rowRank";
    div.innerHTML = `
      <div class="rleft">
        <div class="badge">${medal(r)}</div>
        <div style="min-width:0">
          <div class="mainTxt">${e.correct}/${e.solved} (${e.acc}%)</div>
          <div class="rsub">${e.subject} Â· ${stamp(e.ts)} Â· ${fmt(e.duration)}</div>
        </div>
      </div>
      <div class="rright">
        ${e.acc}%
        <div class="subp">${e.correct}/${e.solved}</div>
      </div>`;
    leader.appendChild(div);
  });
};

const render=()=>{renderKPI(); renderLeader();};

start.onclick=()=>{if(timer)return;sync();lastDur=dur;setFocus(true);
start.disabled=true;pause.disabled=false;m.disabled=true;s.disabled=true;state.textContent="ì§„í–‰ ì¤‘...";
timer=setInterval(()=>{rem--;t.textContent=fmt(Math.max(0,rem));t.style.color=rem<=60?"#b00020":"#111";
if(rem<=0){clearInterval(timer);timer=null;start.disabled=false;pause.disabled=true;m.disabled=false;s.disabled=false;
setFocus(false);state.textContent="ì¤€ë¹„ë¨";err.style.display="none";score.value="";pickSub(subject||"ìˆ˜í•™");dlg.showModal();}},1000);}

pause.onclick=()=>{if(!timer)return;clearInterval(timer);timer=null;
start.disabled=false;pause.disabled=true;m.disabled=false;s.disabled=false;state.textContent="ì¼ì‹œì •ì§€";}

reset.onclick=()=>{if(timer){clearInterval(timer);timer=null}
start.disabled=false;pause.disabled=true;m.disabled=false;s.disabled=false;state.textContent="ì¤€ë¹„ë¨";setFocus(false);sync();}

save.onclick=()=>{err.style.display="none";
const v=score.value.trim(); const mm=v.match(/^(\d+)\s*\/\s*(\d+)$/);
if(!mm){err.textContent="í˜•ì‹ì´ ì˜ëª»ëì–´. ì˜ˆ: 18/25";err.style.display="block";return;}
const correct=parseInt(mm[1],10), solved=parseInt(mm[2],10);
if(!(solved>0 && correct>=0 && correct<=solved)){err.textContent="ìˆ«ìê°€ ì´ìƒí•´. (0 â‰¤ ë§ì€ê°œìˆ˜ â‰¤ í‘¼ê°œìˆ˜)";err.style.display="block";return;}
const acc=Math.round(correct/solved*100);
data.push({ts:Date.now(),subject,correct,solved,acc,duration:lastDur});
localStorage.setItem(KEY,JSON.stringify(data));
dlg.close();render();reset.onclick();}

skip.onclick=()=>{dlg.close();reset.onclick();}
clear.onclick=()=>{if(confirm("ê¸°ë¡ ì „ë¶€ ì‚­ì œí• ê¹Œ?")){data=[];localStorage.setItem(KEY,"[]");render();}}

sync();render();
})();
</script>
</html>
