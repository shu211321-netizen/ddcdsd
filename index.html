<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ë¬¸ì œí’€ì´ íƒ€ì´ë¨¸</title>

<style>
body{margin:0;font-family:system-ui;background:#fff}
#app{min-height:100vh;display:flex;flex-direction:column;justify-content:flex-end;padding:14px}
.card{border:1px solid #e6e6e6;border-radius:18px;padding:14px;margin-top:12px}
.time{font-size:18vw;font-weight:900;text-align:center}
.sub{text-align:center;color:#666}
.row{display:flex;gap:10px;margin-top:10px}
input,button{flex:1;padding:14px;font-size:18px;border-radius:14px;border:1px solid #ccc}
button{background:#111;color:#fff;font-weight:900;border:none}
.sec{background:#eee;color:#111}

.pills{display:flex;gap:10px;margin-top:10px}
.pill{flex:1;padding:12px;border-radius:14px;border:1px solid #ccc;font-weight:900}
.pill.on{background:#111;color:#fff}

.rank{display:flex;flex-direction:column;gap:8px;margin-top:10px}
.rankItem{display:flex;justify-content:space-between;border:1px solid #eee;border-radius:14px;padding:10px}
.badge{font-weight:900}

dialog{border:none;border-radius:18px;padding:16px;width:90vw}
dialog::backdrop{background:rgba(0,0,0,.4)}
</style>
</head>

<body>
<div id="app">

  <!-- íƒ€ì´ë¨¸ -->
  <div class="card">
    <div class="time" id="time">25:00</div>
    <div class="sub" id="state">ì¤€ë¹„ë¨</div>
  </div>

  <!-- ì»¨íŠ¸ë¡¤ -->
  <div class="card">
    <div class="row">
      <input id="min" type="number" value="25">
      <input id="sec" type="number" value="0">
    </div>
    <div class="row">
      <button id="start">ì‹œì‘</button>
      <button id="pause" class="sec">ì¼ì‹œì •ì§€</button>
      <button id="reset" class="sec">ë¦¬ì…‹</button>
    </div>
    <div class="row">
      <button id="noise" class="sec">ğŸ”¥ ì¥ì‘ì†Œë¦¬ ì¼œê¸°</button>
    </div>
  </div>

  <!-- ë­í‚¹ -->
  <div class="card">
    <b>ğŸ† ë­í‚¹</b>
    <div id="rank" class="rank"></div>
  </div>

</div>

<!-- ê²°ê³¼ ì…ë ¥ -->
<dialog id="dlg">
  <b>ê²°ê³¼ ì…ë ¥</b>

  <div class="pills">
    <button id="math" class="pill on">ìˆ˜í•™</button>
    <button id="sci" class="pill">ê³¼í•™</button>
  </div>

  <input id="score" placeholder="ì˜ˆ: 18/25" style="width:100%;margin-top:10px">

  <div class="row">
    <button id="save">ì €ì¥</button>
  </div>
</dialog>

<script>
const timeEl = document.getElementById("time");
const stateEl = document.getElementById("state");
const minEl = document.getElementById("min");
const secEl = document.getElementById("sec");
const dlg = document.getElementById("dlg");
const scoreEl = document.getElementById("score");
const rankEl = document.getElementById("rank");

let subject = "ìˆ˜í•™";
let timer = null;
let remain = 1500;

const fire = new Audio("https://cdn.pixabay.com/audio/2022/03/15/audio_2b0b8d0c8b.mp3");
fire.loop = true;
let noiseOn = false;

const data = JSON.parse(localStorage.getItem("rankData")||"[]");

function fmt(s){
  return String(Math.floor(s/60)).padStart(2,"0")+":"+String(s%60).padStart(2,"0");
}

function renderRank(){
  rankEl.innerHTML="";
  data.sort((a,b)=>b.acc-a.acc || b.solved-a.solved);
  data.slice(0,10).forEach((e,i)=>{
    const div=document.createElement("div");
    div.className="rankItem";
    div.innerHTML=`<div class="badge">${i+1}</div>
    <div>${e.subject} ${e.correct}/${e.solved}</div>
    <div>${e.acc}%</div>`;
    rankEl.appendChild(div);
  });
}

document.getElementById("start").onclick=()=>{
  remain = minEl.value*60 + +secEl.value;
  stateEl.textContent="ì§„í–‰ ì¤‘";
  if(noiseOn) fire.play();
  timer=setInterval(()=>{
    remain--;
    timeEl.textContent=fmt(remain);
    if(remain<=0){
      clearInterval(timer);
      fire.pause();
      dlg.showModal();
    }
  },1000);
};

document.getElementById("pause").onclick=()=>{
  clearInterval(timer);
  fire.pause();
};

document.getElementById("reset").onclick=()=>{
  clearInterval(timer);
  fire.pause();
  timeEl.textContent="25:00";
  stateEl.textContent="ì¤€ë¹„ë¨";
};

document.getElementById("noise").onclick=()=>{
  noiseOn=!noiseOn;
  if(noiseOn){fire.play();event.target.textContent="ğŸ”• ì¥ì‘ì†Œë¦¬ ë„ê¸°";}
  else{fire.pause();event.target.textContent="ğŸ”¥ ì¥ì‘ì†Œë¦¬ ì¼œê¸°";}
};

document.getElementById("math").onclick=()=>{subject="ìˆ˜í•™";math.classList.add("on");sci.classList.remove("on");}
document.getElementById("sci").onclick=()=>{subject="ê³¼í•™";sci.classList.add("on");math.classList.remove("on");}

document.getElementById("save").onclick=()=>{
  const m=scoreEl.value.match(/(\d+)\/(\d+)/);
  if(!m) return;
  const correct=+m[1], solved=+m[2];
  const acc=Math.round(correct/solved*100);
  data.push({subject,correct,solved,acc});
  localStorage.setItem("rankData",JSON.stringify(data));
  dlg.close();
  renderRank();
};

renderRank();
</script>
</body>
</html>
