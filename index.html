<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>50/10 í”Œë˜ë„ˆ íƒ€ì´ë¨¸</title>
<style>
  body{margin:0;font-family:system-ui;background:#fff}
  #app{min-height:100vh;display:flex;flex-direction:column;justify-content:flex-end;padding:14px;box-sizing:border-box;gap:12px}

  .card{border:1px solid #e6e6e6;border-radius:18px;padding:14px}
  .big{font-size:18vw;font-weight:900;text-align:center;letter-spacing:-.04em;line-height:1}
  .sub{text-align:center;color:#666;margin-top:6px}
  .row{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
  button,input{padding:14px;font-size:18px;border-radius:14px;border:1px solid #ccc;box-sizing:border-box}
  button{flex:1;background:#111;color:#fff;font-weight:900;border:none}
  .sec{background:#eee;color:#111}
  .muted{color:#666;font-size:13px;margin-top:8px;line-height:1.35}

  /* pills */
  .pills{display:flex;gap:10px;margin-top:10px}
  .pill{flex:1;padding:12px;border-radius:14px;border:1px solid #ccc;background:#fff;color:#111;font-weight:900}
  .pill.on{background:#111;color:#fff;border-color:#111}

  /* 24h planner */
  .plannerWrap{border:1px solid #eee;border-radius:18px;overflow:hidden}
  .plannerTop{padding:10px 12px;background:#fafafa;display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .plannerHead{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
  .plannerHead b{font-size:14px}
  .plannerStats{font-size:13px;color:#444}
  .plannerTop input{padding:10px 12px;font-size:14px;border-radius:12px}
  .plannerBody{position:relative;height:60vh;overflow:auto;background:#fff}
  .grid{position:relative;height:2880px;} /* 24h * 60min * 2px */
  .hourLine{position:absolute;left:0;right:0;height:1px;background:#f0f0f0}
  .hourLbl{position:absolute;left:10px;transform:translateY(-50%);font-size:12px;color:#999}

  .session{
    position:absolute;left:72px;right:12px;border-radius:14px;padding:10px 12px;
    border:1px solid #eee;box-shadow:0 1px 0 rgba(0,0,0,.03)
  }
  .study{background:#111;color:#fff;border-color:#111}
  .break{background:#f3f3f3;color:#111}
  .session .t{font-weight:900}
  .session .d{font-size:12px;opacity:.85;margin-top:4px}

  dialog{border:none;border-radius:18px;padding:16px;width:90vw;max-width:420px}
  dialog::backdrop{background:rgba(0,0,0,.4)}
  .err{color:#b00020;font-size:13px;margin-top:8px;display:none}
</style>
</head>

<body>
<div id="app">

  <!-- íƒ€ì´ë¨¸ -->
  <div class="card">
    <div class="big" id="time">50:00</div>
    <div class="sub" id="phase">ê³µë¶€ 50ë¶„</div>
    <div class="sub" id="state">ì¤€ë¹„ë¨</div>

    <div class="row">
      <button id="start">ì‹œì‘</button>
      <button id="pause" class="sec" disabled>ì¼ì‹œì •ì§€</button>
      <button id="resume" class="sec" disabled>ì¬ì‹œì‘</button>
      <button id="stop" class="sec" disabled>ì¢…ë£Œ</button>
      <button id="reset" class="sec">ë¦¬ì…‹</button>
    </div>

    <div class="muted">
      âœ… ëª¨ë“œ: <b>50ë¶„ ê³µë¶€ â†’ 10ë¶„ íœ´ì‹</b> ë°˜ë³µ (ê¸´íœ´ì‹ ì—†ìŒ)<br>
      âœ… ê³µë¶€ê°€ ëë‚˜ê±°ë‚˜(50ë¶„) ì¤‘ê°„ ì¢…ë£Œí•˜ë©´ â†’ <b>ìˆ˜í•™/ê³¼í•™ ì„ íƒ + ë¬¸ì œëŸ‰ ì…ë ¥</b><br>
      âœ… ê¸°ë¡ì€ <b>24ì‹œê°„ í”Œë˜ë„ˆ</b>ì— ë¸”ë¡ìœ¼ë¡œ ì €ì¥ë¨
    </div>
  </div>

  <!-- 24ì‹œê°„ í”Œë˜ë„ˆ -->
  <div class="plannerWrap">
    <div class="plannerTop">
      <div class="plannerHead">
        <b>ğŸ—“ï¸ 24ì‹œê°„ í”Œë˜ë„ˆ</b>
        <span class="plannerStats" id="stats">-</span>
      </div>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <input id="day" type="date">
        <button id="clearDay" class="sec" style="flex:0">ì˜¤ëŠ˜ ê¸°ë¡ ì‚­ì œ</button>
      </div>
    </div>
    <div class="plannerBody">
      <div class="grid" id="grid"></div>
    </div>
  </div>

</div>

<!-- ê³µë¶€ ë/ì¤‘ë‹¨ ì‹œ ë¬¸ì œëŸ‰ ì…ë ¥ -->
<dialog id="dlg">
  <b id="dlgTitle">ë¬¸ì œëŸ‰ ì²´í¬</b>
  <div class="muted" id="dlgInfo" style="margin-top:6px"></div>

  <div class="muted" style="margin-top:12px">ê³¼ëª© ì„ íƒ(í•„ìˆ˜)</div>
  <div class="pills">
    <button id="subMath" class="pill on" type="button">ìˆ˜í•™</button>
    <button id="subSci" class="pill" type="button">ê³¼í•™</button>
  </div>

  <div class="muted" style="margin-top:12px">í‘¼ ë¬¸ì œ ìˆ˜(í•„ìˆ˜)</div>
  <input id="solved" type="number" min="0" placeholder="ì˜ˆ: 25" style="width:100%;margin-top:8px">

  <div class="muted" style="margin-top:12px">ì •ë‹µë¥ ë„ ê¸°ë¡í•˜ë ¤ë©´ (ë§ì€/í‘¼) í˜•ì‹ (ì„ íƒ)</div>
  <input id="score" placeholder="ì˜ˆ: 18/25" style="width:100%;margin-top:8px">

  <div class="err" id="err">ì…ë ¥ í™•ì¸í•´ì¤˜.</div>

  <div class="row" style="margin-top:12px">
    <button id="skip" class="sec" type="button">ê±´ë„ˆë›°ê¸°</button>
    <button id="save" type="button">ì €ì¥</button>
  </div>
</dialog>

<script>
(() => {
  const $ = (id)=>document.getElementById(id);

  // ---------- Keys ----------
  const SESS_KEY = "planner_sessions_5010_v2";
  const TIMER_KEY = "timer_5010_state_v2";

  // ---------- UI ----------
  const timeEl = $("time"), phaseEl = $("phase"), stateEl = $("state");
  const startBtn=$("start"), pauseBtn=$("pause"), resumeBtn=$("resume"), stopBtn=$("stop"), resetBtn=$("reset");
  const dayEl=$("day"), gridEl=$("grid"), statsEl=$("stats"), clearDayBtn=$("clearDay");

  const dlg=$("dlg"), dlgInfo=$("dlgInfo");
  const subMathBtn=$("subMath"), subSciBtn=$("subSci");
  const solvedEl=$("solved"), scoreEl=$("score"), errEl=$("err");
  const saveBtn=$("save"), skipBtn=$("skip");

  // ---------- Constants ----------
  const WORK_SEC = 50*60;
  const BREAK_SEC = 10*60;
  const PX_PER_MIN = 2; // 1ë¶„=2px
  const DAY_MS = 24*60*60*1000;

  // ---------- Data ----------
  let sessions = JSON.parse(localStorage.getItem(SESS_KEY) || "[]");
  // session:
  // { type:'study'|'break', startTs, endTs,
  //   subject?:'ìˆ˜í•™'|'ê³¼í•™', solved?:number, correct?:number, acc?:number }

  // ---------- Timer State ----------
  // phase: 'study' | 'break'
  // running, phaseStartTs, elapsedBeforeSec, currentPhasePlannedSec
  // pending: { kind:'toBreak'|'stop', studyId }  // dialog ì™„ë£Œ í›„ ë‹¤ìŒ ë™ì‘ ê²°ì •
  let st = {
    phase: "study",
    running: false,
    phaseStartTs: null,
    elapsedBeforeSec: 0,
    currentPhasePlannedSec: WORK_SEC,
    pending: null
  };

  // ---------- Subject selection for dialog ----------
  let subject = "ìˆ˜í•™";
  function pickSubject(s){
    subject = s;
    subMathBtn.classList.toggle("on", s==="ìˆ˜í•™");
    subSciBtn.classList.toggle("on", s==="ê³¼í•™");
  }
  subMathBtn.onclick = () => pickSubject("ìˆ˜í•™");
  subSciBtn.onclick  = () => pickSubject("ê³¼í•™");

  function saveTimerState(){ localStorage.setItem(TIMER_KEY, JSON.stringify(st)); }
  function loadTimerState(){
    const raw = localStorage.getItem(TIMER_KEY);
    if(!raw) return false;
    try{
      const o = JSON.parse(raw);
      if(!o || typeof o.currentPhasePlannedSec!=="number") return false;
      st = o;
      return true;
    } catch { return false; }
  }

  // ---------- Helpers ----------
  const pad = (n)=>String(n).padStart(2,"0");
  const fmt = (s)=>`${pad(Math.floor(s/60))}:${pad(s%60)}`;

  function todayISO(d=new Date()){
    const tz = d.getTimezoneOffset()*60000;
    return new Date(d.getTime()-tz).toISOString().slice(0,10);
  }
  function dayStartMs(iso){
    const [y,m,dd] = iso.split("-").map(Number);
    return new Date(y, m-1, dd, 0,0,0,0).getTime();
  }
  function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }

  function elapsedSec(){
    if(!st.running) return st.elapsedBeforeSec;
    return st.elapsedBeforeSec + (Date.now()-st.phaseStartTs)/1000;
  }
  function remainSec(){
    return Math.max(0, Math.round(st.currentPhasePlannedSec - elapsedSec()));
  }

  function setPhaseUI(){
    phaseEl.textContent = (st.phase==="study") ? "ê³µë¶€ 50ë¶„" : "íœ´ì‹ 10ë¶„";
  }
  function setButtons(){
    startBtn.disabled = st.running;
    pauseBtn.disabled = !st.running;
    resumeBtn.disabled = st.running || (st.phaseStartTs===null && st.elapsedBeforeSec===0 && !st.running);
    stopBtn.disabled = (st.phaseStartTs===null && st.elapsedBeforeSec===0 && !st.running);
  }
  function drawTime(){
    timeEl.textContent = fmt(remainSec());
  }

  // ---------- Planner Rendering ----------
  function ensureGrid(){
    gridEl.innerHTML = "";
    for(let h=0; h<=24; h++){
      const top = h*60*PX_PER_MIN;
      const line = document.createElement("div");
      line.className = "hourLine";
      line.style.top = top+"px";
      gridEl.appendChild(line);

      if(h<24){
        const lbl = document.createElement("div");
        lbl.className = "hourLbl";
        lbl.style.top = top+"px";
        lbl.textContent = `${pad(h)}:00`;
        gridEl.appendChild(lbl);
      }
    }
  }

  function sessionsForDay(iso){
    const s0 = dayStartMs(iso);
    const s1 = s0 + DAY_MS;
    return sessions.filter(s => s.startTs < s1 && s.endTs > s0);
  }

  function renderPlanner(){
    ensureGrid();
    const iso = dayEl.value;
    const s0 = dayStartMs(iso);
    const list = sessionsForDay(iso);

    // stats
    let studySec=0, breakSec=0;
    let solvedMath=0, solvedSci=0;
    let correctSum=0, solvedForAcc=0;

    for(const s of list){
      const start = Math.max(s.startTs, s0);
      const end   = Math.min(s.endTs, s0+DAY_MS);
      const dur = Math.max(0, Math.round((end-start)/1000));

      if(s.type==="study"){
        studySec += dur;
        if(typeof s.solved==="number"){
          if(s.subject==="ìˆ˜í•™") solvedMath += s.solved;
          if(s.subject==="ê³¼í•™") solvedSci += s.solved;
        }
        if(typeof s.correct==="number" && typeof s.solved==="number"){
          correctSum += s.correct;
          solvedForAcc += s.solved;
        }
      } else breakSec += dur;
    }
    const acc = solvedForAcc>0 ? Math.round(correctSum/solvedForAcc*100) : null;
    statsEl.textContent =
      `ê³µë¶€ ${fmt(studySec)} Â· íœ´ì‹ ${fmt(breakSec)} Â· ìˆ˜í•™ ${solvedMath} Â· ê³¼í•™ ${solvedSci}` +
      (acc!==null ? ` Â· ì •ë‹µë¥  ${acc}%` : "");

    // blocks
    list.forEach((s) => {
      const start = clamp(s.startTs, s0, s0+DAY_MS);
      const end   = clamp(s.endTs,   s0, s0+DAY_MS);

      const startMin = (start - s0)/60000;
      const endMin = (end - s0)/60000;
      const top = startMin * PX_PER_MIN;
      const h = Math.max(18, (endMin - startMin) * PX_PER_MIN);

      const div = document.createElement("div");
      div.className = `session ${s.type==="study"?"study":"break"}`;
      div.style.top = top+"px";
      div.style.height = h+"px";

      const stt = new Date(start);
      const edt = new Date(end);
      const t0 = `${pad(stt.getHours())}:${pad(stt.getMinutes())}`;
      const t1 = `${pad(edt.getHours())}:${pad(edt.getMinutes())}`;

      if(s.type==="study"){
        const subj = s.subject || "ê³¼ëª©?";
        const solved = (typeof s.solved==="number") ? s.solved : 0;
        const accTxt = (typeof s.acc==="number") ? ` Â· ${s.acc}%` : "";
        div.innerHTML = `
          <div class="t">ê³µë¶€(${subj}) ${t0}~${t1}</div>
          <div class="d">í‘¼ë¬¸ì œ ${solved}${accTxt}</div>
        `;
      } else {
        div.innerHTML = `
          <div class="t">íœ´ì‹ ${t0}~${t1}</div>
          <div class="d">10ë¶„ ì‰¬ê¸°</div>
        `;
      }

      gridEl.appendChild(div);
    });
  }

  function saveSessions(){
    localStorage.setItem(SESS_KEY, JSON.stringify(sessions));
  }

  // ---------- Dialog ----------
  function openCheckDialog(info){
    errEl.style.display="none";
    solvedEl.value="";
    scoreEl.value="";
    pickSubject(subject || "ìˆ˜í•™");
    dlgInfo.textContent = info;
    dlg.showModal();
  }
  function closeDialog(){ try{ dlg.close(); } catch{} }

  // ---------- Session helpers ----------
  function makeId(){
    return (crypto?.randomUUID?.() || (String(Date.now())+"_"+Math.random().toString(16).slice(2)));
  }

  function addSession(type, startTs, endTs, extra={}){
    sessions.push({ type, startTs, endTs, ...extra });
    saveSessions();
    renderPlanner();
  }

  function updateStudyResult(studyId, patch){
    const idx = sessions.findIndex(x => x._id === studyId);
    if(idx>=0){
      Object.assign(sessions[idx], patch);
      delete sessions[idx]._id;
      saveSessions();
    }
    renderPlanner();
  }

  // ---------- Phase control ----------
  function startPhase(phase){
    st.phase = phase;
    st.currentPhasePlannedSec = (phase==="study") ? WORK_SEC : BREAK_SEC;
    st.running = true;
    st.phaseStartTs = Date.now();
    st.elapsedBeforeSec = 0;
    st.pending = null;
    setPhaseUI();
    stateEl.textContent = "ì§„í–‰ ì¤‘";
    setButtons();
    saveTimerState();
  }

  function pause(){
    if(!st.running) return;
    st.elapsedBeforeSec = elapsedSec();
    st.running = false;
    st.phaseStartTs = null;
    stateEl.textContent = "ì¼ì‹œì •ì§€";
    setButtons();
    saveTimerState();
  }

  function resume(){
    if(st.running) return;
    st.running = true;
    st.phaseStartTs = Date.now();
    stateEl.textContent = "ì§„í–‰ ì¤‘";
    setButtons();
    saveTimerState();
  }

  // ì¢…ë£Œ:
  // - ê³µë¶€ ì¤‘: ê³µë¶€ ì„¸ì…˜(ë¶€ë¶„) ì €ì¥ + dialog
  // - íœ´ì‹ ì¤‘: íœ´ì‹ ì„¸ì…˜(ë¶€ë¶„) ì €ì¥ í›„ ë©ˆì¶¤
  function stop(){
    if(st.phaseStartTs===null && st.elapsedBeforeSec===0 && !st.running) return;

    const endTs = Date.now();
    const usedSec = Math.max(0, Math.round(elapsedSec()));
    const startTs = endTs - usedSec*1000;

    st.running = false;
    st.phaseStartTs = null;

    if(st.phase==="study"){
      const id = makeId();
      addSession("study", startTs, endTs, { _id:id, subject:null, solved:0 });
      st.pending = { kind:"stop", studyId:id };
      stateEl.textContent = "ì¢…ë£Œë¨(ì²´í¬ ëŒ€ê¸°)";
      setButtons();
      saveTimerState();
      openCheckDialog(`ê³µë¶€ë¥¼ ì¤‘ë‹¨í–ˆì–´. ì´ë²ˆ ê³µë¶€ ì‹œê°„: ${fmt(usedSec)} Â· ê³¼ëª© ì„ íƒí•˜ê³  ë¬¸ì œëŸ‰ ì…ë ¥í•´ì¤˜.`);
    } else {
      addSession("break", startTs, endTs);
      stateEl.textContent = "ì¢…ë£Œë¨";
      setButtons();
      saveTimerState();
    }
  }

  function resetAll(){
    pause();
    st.phase="study";
    st.currentPhasePlannedSec=WORK_SEC;
    st.running=false;
    st.phaseStartTs=null;
    st.elapsedBeforeSec=0;
    st.pending=null;
    setPhaseUI();
    stateEl.textContent="ì¤€ë¹„ë¨";
    drawTime();
    setButtons();
    saveTimerState();
  }

  // ìë™ ì™„ë£Œ:
  // - ê³µë¶€ ë: ê³µë¶€(ì •í™•íˆ 50ë¶„) ì„¸ì…˜ ì €ì¥ + dialog â†’ ì €ì¥í•˜ë©´ íœ´ì‹ ì‹œì‘
  // - íœ´ì‹ ë: íœ´ì‹ ì„¸ì…˜ ì €ì¥ â†’ ë°”ë¡œ ê³µë¶€ ì‹œì‘
  function finishPhaseAuto(){
    const endTs = Date.now();
    const usedSec = st.currentPhasePlannedSec;
    const startTs = endTs - usedSec*1000;

    st.running = false;
    st.phaseStartTs = null;
    st.elapsedBeforeSec = 0;

    if(st.phase==="study"){
      const id = makeId();
      addSession("study", startTs, endTs, { _id:id, subject:null, solved:0 });
      st.pending = { kind:"toBreak", studyId:id };
      stateEl.textContent = "ê³µë¶€ ë(ì²´í¬ ëŒ€ê¸°)";
      setButtons();
      saveTimerState();
      openCheckDialog(`ê³µë¶€ 50ë¶„ ë! ê³¼ëª© ì„ íƒí•˜ê³  í‘¼ ë¬¸ì œ ìˆ˜ ì…ë ¥í•´ì¤˜.`);
    } else {
      addSession("break", startTs, endTs);
      startPhase("study");
    }
  }

  function afterDialog(){
    const p = st.pending;
    st.pending = null;
    saveTimerState();

    if(!p) return;

    if(p.kind==="toBreak"){
      startPhase("break"); // ê³µë¶€ ë â†’ íœ´ì‹ ìë™ ì‹œì‘
    } else {
      // stopì´ë©´ "ì¤€ë¹„ë¨" ìƒíƒœë¡œ
      st.phase="study";
      st.currentPhasePlannedSec=WORK_SEC;
      st.running=false;
      st.phaseStartTs=null;
      st.elapsedBeforeSec=0;
      setPhaseUI();
      stateEl.textContent="ì¤€ë¹„ë¨";
      drawTime();
      setButtons();
      saveTimerState();
    }
  }

  // ---------- Tick ----------
  let tick=null;
  function startTick(){
    if(tick) clearInterval(tick);
    tick=setInterval(()=>{
      drawTime();
      if(st.running && remainSec()<=0){
        finishPhaseAuto();
      }
    }, 300);
  }

  // ---------- Dialog save ----------
  saveBtn.onclick = () => {
    const solved = parseInt(solvedEl.value||"",10);
    if(!(solved>=0)){
      errEl.textContent="í‘¼ ë¬¸ì œ ìˆ˜(ìˆ«ì)ë¥¼ ì ì–´ì¤˜.";
      errEl.style.display="block";
      return;
    }

    // subject í•„ìˆ˜
    if(!(subject==="ìˆ˜í•™" || subject==="ê³¼í•™")){
      errEl.textContent="ê³¼ëª©(ìˆ˜í•™/ê³¼í•™)ì„ ì„ íƒí•´ì¤˜.";
      errEl.style.display="block";
      return;
    }

    // optional accuracy
    let correct = null, acc = null;
    const v = (scoreEl.value||"").trim();
    if(v){
      const m = v.match(/^(\d+)\s*\/\s*(\d+)$/);
      if(!m){
        errEl.textContent="ì •ë‹µë¥  í˜•ì‹ì´ ì˜ëª»ë¨. ì˜ˆ: 18/25";
        errEl.style.display="block";
        return;
      }
      correct = parseInt(m[1],10);
      const denom = parseInt(m[2],10);
      if(!(denom>0 && correct>=0 && correct<=denom)){
        errEl.textContent="ì •ë‹µë¥  ìˆ«ìê°€ ì´ìƒí•´. (0 â‰¤ ë§ì€ â‰¤ í‘¼)";
        errEl.style.display="block";
        return;
      }
      acc = Math.round(correct/denom*100);
    }

    // apply to pending study session
    const p = st.pending;
    if(p?.studyId){
      updateStudyResult(p.studyId, { subject, solved, correct, acc });
    }

    closeDialog();
    afterDialog();
  };

  skipBtn.onclick = () => {
    // ê±´ë„ˆë›°ë©´ subjectëŠ” ê·¸ë˜ë„ ì„ íƒí•´ì•¼ í–ˆë˜ ìš”êµ¬ê°€ ìˆìœ¼ë‹ˆ:
    // -> ê·¸ëƒ¥ "ìˆ˜í•™" ê¸°ë³¸ìœ¼ë¡œ ë„£ê³  solved=0 ì²˜ë¦¬
    const p = st.pending;
    if(p?.studyId){
      updateStudyResult(p.studyId, { subject: (subject==="ê³¼í•™"?"ê³¼í•™":"ìˆ˜í•™"), solved: 0 });
    }
    closeDialog();
    afterDialog();
  };

  // ---------- Controls ----------
  startBtn.onclick = () => {
    if(st.running) return;
    // ì¤€ë¹„/ì´ˆê¸°ë©´ ê³µë¶€ ì‹œì‘, ì•„ë‹ˆë©´ resume
    if(st.phaseStartTs===null && st.elapsedBeforeSec===0 && !st.running){
      startPhase("study");
    } else {
      resume();
    }
  };
  pauseBtn.onclick = pause;
  resumeBtn.onclick = resume;
  stopBtn.onclick = stop;
  resetBtn.onclick = resetAll;

  // ---------- Day selector ----------
  dayEl.value = todayISO();
  dayEl.onchange = renderPlanner;

  clearDayBtn.onclick = () => {
    const iso = dayEl.value;
    if(!confirm(`${iso} ê¸°ë¡ì„ ì „ë¶€ ì‚­ì œí• ê¹Œ?`)) return;
    const s0 = dayStartMs(iso);
    const s1 = s0 + DAY_MS;
    sessions = sessions.filter(s => !(s.startTs < s1 && s.endTs > s0));
    saveSessions();
    renderPlanner();
  };

  // ---------- Restore ----------
  const restored = loadTimerState();
  setPhaseUI();

  if(restored){
    if(st.running) stateEl.textContent="ì§„í–‰ ì¤‘";
    else if(st.phaseStartTs===null && st.elapsedBeforeSec>0) stateEl.textContent="ì¼ì‹œì •ì§€";
    else stateEl.textContent="ì¤€ë¹„ë¨";

    if(st.pending?.studyId){
      openCheckDialog("ì´ì „ì— ê³µë¶€ ì²´í¬ê°€ ë‚¨ì•„ìˆì–´. ê³¼ëª© ì„ íƒí•˜ê³  ì…ë ¥í•´ì¤˜.");
    }
  } else {
    saveTimerState();
  }

  document.addEventListener("visibilitychange", () => {
    saveTimerState();
    if(!document.hidden){
      if(st.running && remainSec()<=0) finishPhaseAuto();
      drawTime();
      setButtons();
      renderPlanner();
    }
  });

  // ---------- Init ----------
  setButtons();
  drawTime();
  renderPlanner();
  startTick();
})();
</script>
</body>
</html>
